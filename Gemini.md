# プロジェクト引継書：日本語タイピング練習Webアプリ

## 1. プロジェクト概要

本プロジェクトは、正確性を重視した日本語タイピング練習Webアプリケーションのプロトタイプです。ユーザーは画面に表示される日本語の文章をローマ字で入力し、その入力の正確性と速度が評価されます。ミスタイプが発生した際には即座にフィードバックが提供され、正しい入力が完了するまで次の文字に進めない厳格な入力制御が特徴です。これにより、ユーザーは正確なタイピングスキルを習得することを目指します。

## 2. 現在の主要機能と画面構成

アプリケーションは以下の主要な画面と機能で構成されています。

### 2.1. トップ画面 (`src/app/page.tsx`)

-   アプリケーションの簡単な説明が表示されます。
-   タイピング練習を開始するための「タイピングを開始する」ボタンが配置されています。

### 2.2. タイピング練習画面 (`src/app/typing/page.tsx`)

-   `TypingGame` コンポーネントが主要なタイピングロジックとユーザーインターフェースを提供します。
-   **入力ロジック**:
    -   表示された日本語の仮名（ひらがな）をローマ字で入力します。
    -   正しいローマ字入力が完了すると、自動的に次の仮名へとカーソルが移動します。
    -   不正な入力があった場合、エラー表示（文字が赤色になるなど）が行われ、ユーザーが正しいローマ字を入力するまで次の文字への進行がブロックされます。
    -   日本語特有のローマ字入力ルール（例: 「ん」の `n` / `nn` / `n'`、促音「っ」の次の子音の重複入力など）に対応しています。
    -   ユーザーが現在入力しているローマ字のバッファが画面上に表示されます。
    -   正しく仮名を入力し終えた際、その文字が一時的に黄色にフラッシュし、視覚的なフィードバックを提供します。
-   **統計情報**:
    -   `totalKeystrokes` (総打鍵数) と `correctKeystrokes` (正解打鍵数) がリアルタイムでカウントされます。
    -   `correctKanaUnits` (正解仮名数) がカウントされます。
    -   `mistakes` 配列に、ミスタイプに関する詳細情報（ミスした文字、期待されたローマ字、実際の入力、打鍵されたキー、仮名のインデックスなど）が記録されます。
-   **操作性**:
    -   `Esc` キーを押すことで、いつでもトップ画面に戻ることができます。
-   **視覚補助**:
    -   `OnScreenKeyboard` コンポーネントが表示され、ユーザーが最後に打鍵したキーがハイライト表示されます。

### 2.3. 結果画面 (`src/app/result/page.tsx`)

-   `ResultDisplay` コンポーネントがタイピング練習の結果を表示します。
-   タイピング結果は `localStorage` からロードされ、以下の情報が表示されます。
    -   **正確性**: 正解打鍵数と総打鍵数に基づいたパーセンテージ。
    -   **タイピング速度**: WPM (Words Per Minute) 形式で表示されます。
    -   **ミスタイプ箇所一覧**: どの文字でミスタイプが発生したかの詳細なリスト。
    -   **ミス傾向分析 (文字別)**: 各文字ごとのミス回数とパターンが集計され、ユーザーが苦手とするキーや文字の傾向を視覚的に把握できます。

## 3. 技術スタック

-   **フレームワーク**: Next.js (App Router)
-   **言語**: TypeScript
-   **スタイリング**: Tailwind CSS

## 4. 主要ファイルと役割

-   `public/kana_romaji_map.json`: ひらがなとローマ字の変換ルールを定義したJSONデータファイル。
-   `src/components/KanaRomajiMap.ts`: `kana_romaji_map.json` をロードし、仮名に対応するローマ字候補を提供するユーティリティ関数群。
-   `src/components/OnScreenKeyboard.tsx`: 画面上に仮想キーボードを表示し、ユーザーのキー入力を視覚的にフィードバックするコンポーネント。
-   `src/components/TypingGame.tsx`: タイピング練習画面のメインコンポーネント。コアロジックはカスタムフックに抽出されており、主にレンダリングを担当します。
-   `src/hooks/useTypingGame.ts`: タイピングゲームのコアロジック（ステート管理、イベントハンドリング、結果計算など）をカプセル化したカスタムフック。
-   `src/utils/typingUtils.ts`: 日本語の文章をタイピング単位（拗音、促音など）に分解するためのヘルパー関数。

## 5. 拡張予定・将来的な機能

以下の機能は、今後の開発で実装が検討されている項目です。

-   **ログイン機能**: GoogleやGitHubなどのOAuthプロバイダーを利用したユーザー認証機能。
-   **苦手分析と練習文の最適化**:
    -   オンラインDBを利用し、ユーザーの苦手な指や単語を分析し、それを改善できる練習文章を誘導する機能(PythonとSQLを使う予定)。
    -   過去の成績をグラフや図で可視化する機能。
-   **スコアランキング**: データベースを利用し、ユーザーのタイピングスコアをオンラインでランキング表示する機能。
-   **ユーザーによる練習文投稿機能**:
    -   オンラインデータベースを用いて、ユーザーがオリジナルの練習文章（小説の一節など）をタイトル付きで投稿・共有できる機能。
    -   現状は「吾輩は猫である」などのサンプル文章のみが利用可能。
-   **練習文章の拡張と表示改善**:
    -   練習文章を漢字やカタカナにも対応させる。
    -   現在入力すべき仮名の下に、対応するローマ字候補を表示するUIを追加。
-   **ペナルティのカスタマイズ**:
    -   ユーザーがミスタイプ時のペナルティの種類（例: 入力ブロック、警告のみなど）を選択できる機能。
    -   **超高難易度モード**: ミスすると最初からやり直し（時間はリセットされない）。画面が揺れる、崩れるなど、緊張感を煽る派手な演出を追加。
-   **UI/UXの改善**:
    -   練習中に表示される仮名やローマ字を非表示にできるオプション機能。
    -   タイピング画面に薄い10本の指のイラストを表示し、次に打つべきキーに対応する指をハイライトする機能。